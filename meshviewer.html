<!DOCTYPE html>
<html>
  <head>
    <title>MeshViewer</title>
    <script type="text/javascript"src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD06ErexK0u1vnaXGci0_JuuwCm2jkN36s&libraries=visualization"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>

#info_area {
  width: 300px;
}

.title, .title2{
  font-weight: bold;
  font-size: 14px;
}

.title2 {
  margin-top: 30px;
}

#drop_zone {
  width: 481px;
  height: 505px;
  background-color:#eee;
  text-align:center;
}

#drop_msg {
  padding-top: 20px;
}

#mycanvas {
  display: none;
  background-color:#eee;
  text-align:center;
  vertical-align: middle;
  cursor: pointer;
}

#around {
  border-collapse: collapse;
}

#around td {
  border: solid 1px #aaa;
  margin: 0;
  width: 40px;
  text-align: right;
  font-size: 8px;

}
    </style>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <div id="info_area">
            <h4>MSM予報雨量を確認する</h4>
            <div class="title">マウスカーソル位置の情報</div>
            <table>
              <tr><td>座標</td><td><span id="pos"></span></td></tr>
              <tr><td>緯度・経度</td><td><span id="lati"></span></td></tr>
              <tr><td>降水量</td><td><span id="value"></span></td></tr>
            </table>

            <table id="around">
              <tr><td id="v_m1m1">0</td><td id="v_0m1">0</td><td id="v_p1m1">0</td></tr>
              <tr><td id="v_m10">0</td><td id="v_00">0</td><td id="v_p10">0</td></tr>
              <tr><td id="v_m1p1">0</td><td id="v_0p1">0</td><td id="v_p1p1">0</td></tr>
            </table>

            <div class="title2">クリック時の情報</div>
            <table>
              <tr><td>座標</td><td><span id="click_pos"></span></td></tr>
              <tr><td>緯度・経度</td><td><span id="click_lati"></span></td></tr>
              <tr><td>降水量</td><td><span id="click_value"></span></td></tr>
            </table>
          </div>
        </td>
        <td valign="top">
          <div id="drop_zone">
            <div id="drop_msg">ここにMSMデータの csv ファイルをドロップしてください</div>
            <canvas id="mycanvas" width="481" height="505"></canvas>
          </div>
        </td>
        <td valign="top">
          <div id="map_canvas" style="width:481px; height:505px"></div>
        </td>
      </tr>
    </table>
    <script type="text/javascript">

!function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=5)}([function(a,b){function c(a){function b(a){}function c(a){}function d(b){if(null!=f.mesh){var c=f.mesh.meshArray,d=b.target.getBoundingClientRect();f.x=b.clientX-d.left,f.y=b.clientY-d.top;var e=f.x,g=f.y;f.latitude=Math.round(1e4*(a.mapInfo.startLatitude-g*a.mapInfo.widthLongitude),4)/1e4,f.longitude=Math.round(1e4*(a.mapInfo.startLongitude+e*a.mapInfo.widthLatitude),4)/1e4,f.value=c[g][e],document.getElementById("pos").innerHTML="("+e+" , "+g+")",document.getElementById("lati").innerHTML="("+f.latitude+" , "+f.longitude+")",document.getElementById("value").innerHTML=f.value+" mm",document.getElementById("v_m1m1").innerHTML=c[g-1][e-1],document.getElementById("v_0m1").innerHTML=c[g-1][e],document.getElementById("v_p1m1").innerHTML=c[g-1][e+1],document.getElementById("v_m10").innerHTML=c[g][e-1],document.getElementById("v_00").innerHTML=c[g][e],document.getElementById("v_p10").innerHTML=c[g][e+1],document.getElementById("v_m1p1").innerHTML=c[g+1][e-1],document.getElementById("v_0p1").innerHTML=c[g+1][e],document.getElementById("v_p1p1").innerHTML=c[g+1][e+1]}}function e(a){null!=f.mesh&&(f.params.clickHandlers.forEach(function(a){a({latitude:f.latitude,longitude:f.longitude,value:f.value})}),document.getElementById("click_pos").innerHTML="("+f.x+" , "+f.y+")",document.getElementById("click_lati").innerHTML="("+f.latitude+" , "+f.longitude+")",document.getElementById("click_value").innerHTML=f.value+" mm")}var f=this;f.params=a,f.canvas=document.getElementById("mycanvas"),f.context=f.canvas.getContext("2d"),f.mesh=null,f.x=0,f.y=0,f.canvas.addEventListener("mouseover",b,!1),f.canvas.addEventListener("mouseout",c,!1),f.canvas.addEventListener("mousemove",d,!1),f.canvas.addEventListener("click",e,!1),f.drawMesh=function(a){f.mesh=a;var b=a.meshArray;f.canvas.width=b[0].length,f.canvas.height=b.length;for(var c=20,d=0,e=Array.prototype.concat.apply([],b),g=0;g<e.length;g++)c<e[g]?c=e[g]:d>e[g]&&(d=e[g]);for(var h=f.context.getImageData(0,0,f.canvas.width,f.canvas.height),i=h.width,j=h.height,k=h.data,l=0;l<j;++l)for(var m=0;m<i;++m){var n=4*(l*i+m),o=b[l][m],p=255*(o-d)/(c-d),q=255-p;k[n+0]=q,k[n+1]=q,k[n+2]=q,k[n+3]=255}f.canvas.style.display="block",document.getElementById("drop_msg").style.display="none",f.context.putImageData(h,0,0)}}a.exports=c},function(a,b,c){function d(a){function b(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"}function c(b){b.stopPropagation(),b.preventDefault();var c=b.dataTransfer.files,f=c[0],g=(escape(f.name),new FileReader);g.onload=function(b){return function(b){var c=new e(g.result);d.meshes.push(c),a.createMeshHandlers.forEach(function(a){a(c)})}}(),g.readAsText(f)}var d=this;d.params=a,d.meshes=[];var f=document.getElementById(a.id);f.addEventListener("dragover",b,!1),f.addEventListener("drop",c,!1)}var e=c(4);a.exports=d},function(a,b){function c(a){var b=this;b.params=a;var c=new google.maps.LatLng(38.65,138.25),d={zoom:5,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP};b.map=new google.maps.Map(document.getElementById(a.id),d),b.marker=new google.maps.Marker({position:c}),b.heatmap=null,b.setHeartMap=function(c){for(var d=c.meshArray,e=20,f=0,g=Array.prototype.concat.apply([],d),h=0;h<g.length;h++)e<g[h]?e=g[h]:f>g[h]&&(f=g[h]);for(var i=d[0].length,j=d.length,k=[],l=0;l<j;++l)for(var m=0;m<i;++m){var n=d[l][m],o=255*(n-f)/(e-f),p=a.mapInfo.startLatitude-l*a.mapInfo.widthLongitude,q=a.mapInfo.startLongitude+m*a.mapInfo.widthLatitude;0!=o&&k.push({location:new google.maps.LatLng(p,q),weight:o})}null!=b.heatmap&&b.heatmap.setMap(null),b.heatmap=new google.maps.visualization.HeatmapLayer({data:k,radius:10,maxIntensity:255,opacity:.4}),b.heatmap.setMap(b.map)},b.setMarker=function(a){var c=new google.maps.LatLng(a.latitude,a.longitude);b.map.panTo(c),b.marker.setMap(b.map),b.marker.setPosition(c)}}a.exports=c},function(a,b){a.exports={startLatitude:46.7,startLongitude:120,widthLatitude:.0625,widthLongitude:.05}},function(a,b){function c(a){this.meshArray=function(a){return a.split("\n").filter(function(a){return""!=a}).map(function(a){return a.split(",").filter(function(a){return""!=a})})}(a)}a.exports=c},function(a,b,c){var d=c(2),e=c(1),f=c(0),g=c(3),h=new d({id:"map_canvas",mapInfo:g}),i=new f({id:"mycanvas",mapInfo:g,moveHandlers:[],clickHandlers:[h.setMarker]});new e({id:"drop_zone",createMeshHandlers:[i.drawMesh,h.setHeartMap]})}]);
    </script>
  </body>
</html>
