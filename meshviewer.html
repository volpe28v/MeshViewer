<!DOCTYPE html>
<html>
  <head>
    <title>MeshViewer</title>
    <script type="text/javascript"src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD06ErexK0u1vnaXGci0_JuuwCm2jkN36s&libraries=visualization"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>

#info_area {
  width: 300px;
}

.title, .title2{
  font-weight: bold;
  font-size: 14px;
}

#drop_zone {
  width: 481px;
  height: 505px;
  background-color:#eee;
  text-align:center;
}

#drop_msg {
  padding-top: 20px;
}

#mycanvas {
  display: none;
  background-color:#eee;
  text-align:center;
  vertical-align: middle;
  cursor: pointer;
}

#around {
  border-collapse: collapse;
}

#around td {
  border: solid 1px #aaa;
  margin: 0;
  width: 60px;
  text-align: right;
  font-size: 8px;
}

#file_name {
  font-size: 14px;
}

#file_list {
  font-size: 12px;
}

    </style>
  </head>
  <body>
    <table>
      <tr>
        <td valign="top">
          <div id="info_area">
            <h4>MSM予報雨量を確認する</h4>
            <input type="button" id="pre_mesh" value="<"/>
            <input type="button" id="next_mesh" value=">"/>
            <div id="file_name"></div>
            <ul id="file_list"></ul>
          </div>
        </td>
        <td valign="top">
          <div id="drop_zone">
            <div id="drop_msg">ここにMSMデータの csv ファイルをドロップしてください</div>
            <canvas id="mycanvas" width="481" height="505"></canvas>
          </div>

          <table>
            <tr><td>座標</td><td><span id="pos"></span></td></tr>
            <tr><td>緯度・経度</td><td><span id="lati"></span></td></tr>
            <tr><td>降水量</td><td><span id="value"></span></td></tr>
          </table>

          <table id="around">
            <tr><td id="v_m1m1">0</td><td id="v_0m1">0</td><td id="v_p1m1">0</td></tr>
            <tr><td id="v_m10">0</td><td id="v_00">0</td><td id="v_p10">0</td></tr>
            <tr><td id="v_m1p1">0</td><td id="v_0p1">0</td><td id="v_p1p1">0</td></tr>
          </table>
        </td>
        <td valign="top">
          <div id="map_canvas" style="width:481px; height:505px"></div>

          <table>
            <tr><td>座標</td><td><span id="click_pos"></span></td></tr>
            <tr><td>緯度・経度</td><td><span id="click_lati"></span></td></tr>
            <tr><td>降水量</td><td><span id="click_value"></span></td></tr>
          </table>
        </td>
      </tr>
    </table>
    <script type="text/javascript">
!function(e){function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=7)}([function(e,n){function t(e){function n(e){}function t(e){}function a(n){if(null!=r.mesh){var t=r.mesh.meshArray,a=n.target.getBoundingClientRect();r.x=n.clientX-a.left,r.y=n.clientY-a.top;var o=r.x,i=r.y;r.latitude=Math.round(1e4*(e.mapInfo.startLatitude-i*e.mapInfo.widthLongitude),4)/1e4,r.longitude=Math.round(1e4*(e.mapInfo.startLongitude+o*e.mapInfo.widthLatitude),4)/1e4,r.value=t[i][o],document.getElementById("pos").innerHTML="("+o+" , "+i+")",document.getElementById("lati").innerHTML="("+r.latitude+" , "+r.longitude+")",document.getElementById("value").innerHTML=r.value+" mm",document.getElementById("v_m1m1").innerHTML=t[i-1][o-1],document.getElementById("v_0m1").innerHTML=t[i-1][o],document.getElementById("v_p1m1").innerHTML=t[i-1][o+1],document.getElementById("v_m10").innerHTML=t[i][o-1],document.getElementById("v_00").innerHTML=t[i][o],document.getElementById("v_p10").innerHTML=t[i][o+1],document.getElementById("v_m1p1").innerHTML=t[i+1][o-1],document.getElementById("v_0p1").innerHTML=t[i+1][o],document.getElementById("v_p1p1").innerHTML=t[i+1][o+1]}}function o(e){null!=r.mesh&&(r.params.clickHandlers.forEach(function(e){e({latitude:r.latitude,longitude:r.longitude,value:r.value})}),document.getElementById("click_pos").innerHTML="("+r.x+" , "+r.y+")",document.getElementById("click_lati").innerHTML="("+r.latitude+" , "+r.longitude+")",document.getElementById("click_value").innerHTML=r.value+" mm")}var r=this;r.params=e,r.canvas=document.getElementById("mycanvas"),r.context=r.canvas.getContext("2d"),r.mesh=null,r.x=0,r.y=0,r.canvas.addEventListener("mouseover",n,!1),r.canvas.addEventListener("mouseout",t,!1),r.canvas.addEventListener("mousemove",a,!1),r.canvas.addEventListener("click",o,!1),r.drawMesh=function(e){r.mesh=e;var n=e.meshArray;r.canvas.width=n[0].length,r.canvas.height=n.length;for(var t=10,a=0,o=Array.prototype.concat.apply([],n),i=0;i<o.length;i++)t<o[i]?t=o[i]:a>o[i]&&(a=o[i]);for(var u=r.context.getImageData(0,0,r.canvas.width,r.canvas.height),c=u.width,s=u.height,m=u.data,d=0;d<s;++d)for(var l=0;l<c;++l){var p=4*(d*c+l),f=n[d][l],v=255*(f-a)/(t-a),g=255-v;m[p+0]=g,m[p+1]=g,m[p+2]=g,m[p+3]=255}r.canvas.style.display="block",document.getElementById("drop_msg").style.display="none",r.context.putImageData(u,0,0),document.getElementById("file_name").innerHTML=e.name}}e.exports=t},function(e,n,t){function a(e){function n(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function t(n){n.stopPropagation(),n.preventDefault();for(var t,a=n.dataTransfer.files,r=[],i=0;t=a[i];i++)r.push(t);r.sort(function(e,n){return e.name>n.name?1:e.name<n.name?-1:0});for(var i=0;i<r.length;i++){var t=r[i],u=(escape(t.name),new FileReader);u.onload=function(n){return function(t){var a=new o(n.name,t.target.result);e.createMeshHandlers.forEach(function(e){e(a)})}}(t),u.readAsText(t)}}this.params=e;var a=document.getElementById(e.id);a.addEventListener("dragover",n,!1),a.addEventListener("drop",t,!1)}var o=t(6);e.exports=a},function(e,n){function t(e){function n(){document.getElementById(t.params.id).innerHTML=t.meshes.map(function(e){return e==t.active?"<li><b>"+e.name+"</b></li>":"<li>"+e.name+"</li>"}).join("\n")}var t=this;t.params=e,t.meshes=null,t.active=null,t.updateList=function(e){t.meshes=e,n()},t.updateActive=function(e){t.active=e,n()}}e.exports=t},function(e,n){function t(e){var n=this;n.params=e;var t=new google.maps.LatLng(38.65,138.25),a={zoom:5,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP};n.map=new google.maps.Map(document.getElementById(e.id),a),n.marker=new google.maps.Marker({position:t}),n.heatmap=null,n.setHeartMap=function(t){for(var a=t.meshArray,o=20,r=0,i=Array.prototype.concat.apply([],a),u=0;u<i.length;u++)o<i[u]?o=i[u]:r>i[u]&&(r=i[u]);for(var c=a[0].length,s=a.length,m=[],d=0;d<s;++d)for(var l=0;l<c;++l){var p=a[d][l],f=255*(p-r)/(o-r),v=e.mapInfo.startLatitude-d*e.mapInfo.widthLongitude,g=e.mapInfo.startLongitude+l*e.mapInfo.widthLatitude;0!=f&&m.push({location:new google.maps.LatLng(v,g),weight:f})}null!=n.heatmap&&(n.heatmap.setMap(null),n.heatmap.setData([])),n.heatmap=new google.maps.visualization.HeatmapLayer({data:m,radius:10,maxIntensity:255,opacity:.4}),n.heatmap.setMap(n.map)},n.setMarker=function(e){var t=new google.maps.LatLng(e.latitude,e.longitude);n.map.panTo(t),n.marker.setMap(n.map),n.marker.setPosition(t)}}e.exports=t},function(e,n){e.exports={startLatitude:46.7,startLongitude:120,widthLatitude:.0625,widthLongitude:.05}},function(e,n){function t(e){function n(){a.params.changeActiveMeshHandlers.forEach(function(e){e(a.active)})}function t(){for(var e=0;e<a.meshes.length;e++)if(a.meshes[e]==a.active)return e;return 0}var a=this;a.params=e,a.meshes=[],a.active=null,a.add=function(e){a.meshes.push(e),a.meshes.sort(function(e,n){return e.name>n.name?1:e.name<n.name?-1:0}),a.params.changeCollectionHandlers.forEach(function(e){e(a.meshes)}),null==a.active&&(a.active=e,n())},a.pre=function(){var e=t();e-=1,e<0&&(e=a.meshes.length-1),a.active=a.meshes[e],n()},a.next=function(){var e=t();e+=1,e>=a.meshes.length&&(e=0),a.active=a.meshes[e],n()}}e.exports=t},function(e,n){function t(e,n){function t(e){return e.split("\n").filter(function(e){return""!=e}).map(function(e){return e.split(",").filter(function(e){return""!=e})})}var a=this;a.name=e,a.meshArray=t(n)}e.exports=t},function(e,n,t){var a=t(3),o=t(1),r=t(0),i=t(5),u=t(2),c=t(4),s=new a({id:"map_canvas",mapInfo:c}),m=new r({id:"mycanvas",mapInfo:c,moveHandlers:[],clickHandlers:[s.setMarker]}),d=new u({id:"file_list"}),l=new i({changeCollectionHandlers:[d.updateList],changeActiveMeshHandlers:[m.drawMesh,s.setHeartMap,d.updateActive]});new o({id:"drop_zone",createMeshHandlers:[l.add]});window.onload=function(){document.getElementById("pre_mesh").onclick=function(){l.pre()},document.getElementById("next_mesh").onclick=function(){l.next()}}}]);    </script>
  </body>
</html>
